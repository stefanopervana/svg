
<h1 class="calibre11" id="calibre_pb_0"><span class="keep-together">Chapter 2. </span>Animating with CSS</h1>

<p class="author1">You<a contenteditable="false" data-primary="CSS animations" data-secondary="keyframe value definitions" data-type="indexterm" id="idm140658633987776" class="calibre7"></a> <a contenteditable="false" data-primary="CSS animations" data-type="indexterm" id="cssa2" class="calibre7"></a>may find working with SVG code feels very familiar, mostly because an SVG has a DOM, just like standard HTML markup. This is hugely valuable when working with CSS animations, as manipulating markup with CSS is already a very comfortable process for most frontend developers.</p>

<p class="author1">For a very brief review, let’s first establish that a CSS animation is created by defining two parameters. First, there are the keyframes themselves:</p>

<pre data-type="programlisting" class="calibre24">
@keyframes animation-name-you-pick {
  0% {
   background: blue;
   transform: translateX(0);
 }
  50% {
   background: purple;
   transform: translateX(50px);
 }
  100% {
   background: red;
   transform: translateX(100px);
 }
}</pre>


<h1 class="calibre27" id="calibre_pb_1">Keyframe Syntax Hint</h1>

<p class="author1">You can also define <code class="calibre15">from</code> and <code class="calibre15">to</code> instead of percentages. If you declare nothing in either the initial keyframe or the ending keyframe, the animation will use the default or declared properties on the element. It may be worth double-checking your work in all browsers if you do remove them, though, due to strange and inconsistent browser bugs.</p>
</div>

<p class="author1">After <a contenteditable="false" data-primary="CSS animations" data-secondary="syntax declarations" data-type="indexterm" id="cssa2sd" class="calibre7"></a>you define the keyframe values, you have two options for animation syntax declaration. Here’s an example of the long form, with each declaration defined separately:</p>

<pre data-type="programlisting" class="calibre24">
.ball {
  animation-name: animation-name-you-pick;
  animation-duration: 2s;
  animation-delay: 2s;
  animation-iteration-count: 3;
  animation-direction: alternate;
  animation-timing-function: ease-in-out;
  animation-fill-mode: forwards;
}</pre>

<p class="author1">And here’s the shorthand (my preferred method, as it uses less code):</p>

<pre data-type="programlisting" class="calibre24">
.ball {
  animation: animation-name-you-pick 2s 2s 3 alternate ease-in-out forwards;
}
</pre>

<p class="author1">The order of the declarations is interchangeable in a space-separated list, except for the number values, which must be defined in this order: duration, delay, and iteration count.</p>

<p class="author1">Let’s apply this animation to this very simple <code class="calibre15">.ball</code> div (shown in <a data-type="xref" href="part0007_split_001.html#fig2.1" class="calibre7">Figure 2-1</a>):</p>

<pre data-type="programlisting" class="calibre24">
.ball {
  border-radius: 50%;
  width: 50px;
  height: 50px;
  margin: 20px; // so that it's not hitting the edge of the page
  background: black;
}
</pre>

<figure class="calibre25"><div id="fig2.1" class="figure"><img alt="" class="iimagesimage11png" src="../images/00017.gif"/>
<h6 class="calibre26"><span class="keep-together">Figure 2-1. </span>The result of applying .ball div</h6>
</div></figure>

<p class="author1">We get the result in <a data-type="xref" href="part0007_split_001.html#fig2.2" class="calibre7">Figure 2-2</a>, with interstitial states shown less opaque.</p>

<figure class="calibre25"><div id="fig2.2" class="figure"><img alt="" class="iimagesimage11png" src="../images/00018.jpeg"/>
<h6 class="calibre26"><span class="keep-together">Figure 2-2. </span>The result of adjusting the ball div</h6>
</div></figure>

<p class="author1">You can see all the code in action in <a href="http://bit.ly/2lSB8KZ" class="calibre7">a demo I created</a>.</p>

<p class="author1">For more information and further detail about each animation property, such as what <code class="calibre15">animation-fill-mode</code> is, what eases are available in CSS, and which properties are animatable, see <a class="calibre7" href="http://shop.oreilly.com/product/0636920041658.do"><em class="calibre2">Transitions and Animations in CSS</em></a> by Estelle Weyl (O’Reilly).</p>

<p class="author1">You can also <a contenteditable="false" data-primary="CSS animations" data-secondary="syntax declarations" data-startref="cssa2sd" data-type="indexterm" id="idm140658633963888" class="calibre7"></a>consult <em class="calibre2">Pro CSS3 Animation</em>, by Dudley Storey (Apress).</p>

<h1 class="calibre12" id="calibre_pb_2">Animating with SVG</h1>

<p class="author1">Let’s <a contenteditable="false" data-primary="CSS animations" data-secondary="versus SVG" data-secondary-sortas="SVG" data-type="indexterm" id="cssa2vsvg" class="calibre7"></a>say instead of drawing the ball with CSS, we had drawn it with SVG. We know how to do that from the last chapter. To get the same black circle as in <a data-type="xref" href="part0007_split_001.html#fig2.1" class="calibre7">Figure 2-1</a>, we would write:</p>

<pre data-type="programlisting" class="calibre24">
&lt;svg width="70px" height="70px" viewBox="0 0 70 70"&gt;
  &lt;circle fill="black" cx="45" cy="45" r="25"/&gt;
&lt;/svg&gt;
</pre>

<p class="author1">We define the radius as half of 50, so 25 px. Then we move the center of the circle on both the x- and y-axes (<code class="calibre15">cx</code> and <code class="calibre15">cy</code>) to half the radius, plus that 20 px margin we added in the CSS. We could also use <code class="calibre15">margin</code> on the SVG element to move it, but here I’m illustrating that you can draw coordinates directly in the SVG itself. If we move the circle over, though, the <code class="calibre15">viewBox</code> <a contenteditable="false" data-primary="viewBox" data-secondary="sizing" data-type="indexterm" id="vb2s" class="calibre7"></a>has to be larger to accommodate these coordinates: it’s the width plus the margin of space to the edge.</p>

<p class="author1">Now, if we place a class on the whole SVG called <code class="calibre15">ball</code>, using the same animation declaration, we get what’s shown in <a data-type="xref" href="part0007_split_002.html#fig2.3" class="calibre7">Figure 2-3</a>.</p>

<figure class="calibre25"><div id="fig2.3" class="figure"><img alt="" class="iimagesimage11png" src="../images/00019.jpeg"/>
<h6 class="calibre26"><span class="keep-together">Figure 2-3. </span>The result of placing the ball class on the SVG</h6>
</div></figure>

<p class="author1">What happened here? It still moved across, as we were expecting. But the background is filling in the full background of the SVG, thus the entire <code class="calibre15">viewBox</code>. That’s not really what we want. So what happens if we move that class and target the circle instead? See <a data-type="xref" href="part0007_split_002.html#fig2.4" class="calibre7">Figure 2-4</a>.</p>

<figure class="calibre25"><div id="fig2.4" class="figure"><img alt="" class="iimagesimage11png" src="../images/00020.gif"/>
<h6 class="calibre26"><span class="keep-together">Figure 2-4. </span>The result of moving the ball class</h6>
</div></figure>

<p class="author1">You may have guessed why we have this output. There are two reasons:</p>

<ol class="calibre41">
	<li value="1" class="calibre10">
	<p class="author1">The <code class="calibre15">circle</code> is moving inside the <code class="calibre15">viewBox</code>. Remember, if we move an internal SVG attribute, the <code class="calibre15">viewBox</code> will quite literally be a window through which we view these elements. So if we move the <code class="calibre15">circle</code> without making the <code class="calibre15">viewBox</code> large enough to accommodate those coordinates, it will be cut off when the circle moves out of the <a contenteditable="false" data-primary="viewBox" data-secondary="sizing" data-startref="vb2s" data-type="indexterm" id="idm140658633935040" class="calibre7"></a><code class="calibre15">viewBox</code>.</p>
	</li>
	<li value="2" class="calibre10">
	<p class="author1">The SVG DOM looks like the HTML DOM, but it’s slightly different. We don’t use <code class="calibre15">background</code> on SVG attributes; we use <code class="calibre15">fill</code> and <code class="calibre15">stroke</code>. An external stylesheet will also have a hard time overriding what is defined inline within the SVG. So let’s take out the <code class="calibre15">fill</code> definition, <a contenteditable="false" data-primary="fill" data-type="indexterm" id="fill2" class="calibre7"></a>and move that into our stylesheet.</p>
	</li>
</ol>

<p class="author1">The resulting code should be this:</p>

<pre data-type="programlisting" class="calibre24">
&lt;svg width="200px" height="70px" viewBox="0 0 200 70"&gt;
 &lt;circle class="ball3" cx="45" cy="45" r="25"/&gt;
&lt;/svg&gt;
</pre>

<p class="author1">And here’s the CSS:</p>

<pre data-type="programlisting" class="calibre24">
.ball3 {
 animation: second-animation 2s 2s 3 alternate ease-in-out forwards;
}

@keyframes second-animation {
  0% {
   fill: blue;
   transform: translateX(0);
 }
  50% {
   fill: purple;
   transform: translateX(50px);
 }
  100% {
   fill: red;
   transform: translateX(100px);
 }
}</pre>

<p class="author1">The result is <a data-type="xref" href="part0007_split_002.html#fig2.5" class="calibre7">Figure 2-5</a>, but with an SVG instead of an HTML div.</p>

<figure class="calibre25"><div id="fig2.5" class="figure"><img alt="" class="iimagesimage11png" src="../images/00021.jpeg"/>
<h6 class="calibre26"><span class="keep-together">Figure 2-5. </span>The result of taking out the fill definition and moving it to the stylesheet</h6>

<h1 class="calibre12" id="calibre_pb_3">Benefits of Drawing with SVG</h1>

<p class="author1">So, <a contenteditable="false" data-primary="fill" data-startref="fill2" data-type="indexterm" id="idm140658633922272" class="calibre7"></a>why <a contenteditable="false" data-primary="SVGs" data-secondary="benefits of drawing with" data-type="indexterm" id="svgs2bodw" class="calibre7"></a>learn SVG when you could build something in CSS-styled HTML and animate that way?</p>

<p class="author1">First of all, even that small, simple circle was four lines less than the CSS version. SVG was built for drawing—unlike CSS, which was built for presentational formatting. Let’s look at the code for the star from the first chapter of this book:</p>

<pre data-type="programlisting" class="calibre24">
&lt;polygon fill="white" stroke="black" points="279,5 294,35 328,40 
   303,62 309,94 279,79 248,94 254,62 230,39 263,35 "/&gt;</pre>

<p class="author1">It would be incredibly difficult to draw a star in CSS with such a small amount of code, and impossible for the code to be that concise once compiled, if using a preprocessor.</p>

<p class="author1"><a data-type="xref" href="part0007_split_003.html#fig2.6" class="calibre7">Figure 2-6</a> is something I drew in Illustrator.</p>

<figure class="calibre25"><div id="fig2.6" class="figure"><img alt="" class="iimagesimage11png" src="../images/00022.jpeg"/>
<h6 class="calibre26"><span class="keep-together">Figure 2-6. </span>An example of the ease of Illustrator</h6>
</div></figure>

<p class="author1">We could also probably draw this in CSS, but to what end? If you’re working with a designer on a project, having them draw something for you in CSS is not typically an option, and drawings that you want to animate can get much more complex than this. In SVG you can also make the whole image scale easily, and therefore, your whole animation can be responsive.</p>

<p class="author1">All of the information for the illustration is just <em class="calibre2">2 KB gzipped</em>, and it can fill up a whole screen. That’s pretty amazing if you consider raster image alternatives.</p>

<p class="author1">Applying what we just learned about the circle, we can look at some of these shapes and think about what we can do with them. We could group all of the parts of the cow together and make it jump over the moon. We could make the astronaut’s “surprised” expression disappear and appear. We can even make the helmet go up and down so it looks like the astronaut is looking up. <a contenteditable="false" data-primary="SVGs" data-secondary="benefits of drawing with" data-startref="svgs2bodw" data-type="indexterm" id="idm140658633907008" class="calibre7"></a><a contenteditable="false" data-primary="CSS animations" data-secondary="versus SVG" data-startref="cssa2vsvg" data-type="indexterm" id="idm140658633906080" class="calibre7"></a>(That is actually what I did in the final animation.)</p>
<h1 class="calibre12" id="calibre_pb_4">Silky-Smooth Animation</h1>

<p class="author1">It’s tempting to use all of the same properties that you use to affect layout with CSS: <code class="calibre15">margin</code>, <code class="calibre15">top</code>, <code class="calibre15">left</code>, etc. But browsers do not update values for all properties equally. To animate cheaply, your best bet is to use <a contenteditable="false" data-primary="transforms" data-type="indexterm" id="idm140658633909952" class="calibre7"></a><em class="calibre2">transforms</em> and <a contenteditable="false" data-primary="opacity" data-type="indexterm" id="idm140658633902944" class="calibre7"></a><em class="calibre2">opacity</em>. That might seem limiting, but transforms offer translation (positioning), scale, and rotation. Using these in combination with opacity can be extremely powerful. It’s surprising how much can be achieved with these properties in standard animations.</p>

<p class="author1">Throughout this book, I will use these properties wherever possible while demonstrating various techniques. It is important to note that SVG DOM <a contenteditable="false" data-primary="DOM (Document Object Model)" data-secondary="elements" data-type="indexterm" id="idm140658633898000" class="calibre7"></a>elements are currently hardware-accelerated only in some browsers (for instance, hardware acceleration is supported in Firefox but not Chrome), but you should still be moving the SVG DOM with transforms, not margins or other CSS positioning.</p>

<p class="author1">At the time of publishing, Microsoft Internet Explorer (IE) and <a contenteditable="false" data-primary="Edge" data-type="indexterm" id="idm140658633894688" class="calibre7"></a><a contenteditable="false" data-primary="Internet Explorer (IE)" data-type="indexterm" id="idm140658633895584" class="calibre7"></a>Edge did not support transforms on SVG elements at all—but you can vote on these issues and more on <a href="http://bit.ly/2lkk4f8" class="calibre7">the Windows Developer Feedback site</a>.</p>

<p class="author1">Until this is supported, your best bet for Edge is using either native SVG transforms (which are a pain and you’ll need JavaScript for) or the <a contenteditable="false" data-primary="GreenSock (GSAP)" data-type="indexterm" id="idm140658633899456" class="calibre7"></a>GreenSock Animation API, which has support back to IE9.</p>

<p class="author1">For more information on how to properly keep your layout repaint costs low (these are Chrome-specific resources), check <a contenteditable="false" data-primary="High Performance Animations" data-type="indexterm" id="idm140658633892064" class="calibre7"></a><a contenteditable="false" data-primary="Jank Free" data-type="indexterm" id="idm140658633891376" class="calibre7"></a>out <a href="http://jankfree.org/" class="calibre7">Jank Free</a> and <a href="http://bit.ly/2lPFlRo" class="calibre7">High Performance Animations</a>.</p>

<p class="author1">For information on the costs of individual <a contenteditable="false" data-primary="CSS animations" data-startref="cssa2" data-type="indexterm" id="idm140658633887056" class="calibre7"></a>properties, see <a href="http://csstriggers.com/" class="calibre7">CSS Triggers</a>.</p>